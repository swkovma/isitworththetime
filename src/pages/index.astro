---
import Layout from '@layouts/Layout.astro';
import { frequencies, timeSavings, getCellDisplay } from '@lib/calculations';

// Pre-calculate table values at build time (default: $100k, monthly, money mode)
const DEFAULT_SALARY = 100000;
const DEFAULT_SALARY_STR = '100,000';
const DEFAULT_PERIOD = 'monthly' as const;
const DEFAULT_MODE = 'money' as const;
const DEFAULT_CURRENCY = '$';

const preCalculatedData = timeSavings.map(time =>
  frequencies.map(freq =>
    getCellDisplay(DEFAULT_SALARY, freq.multiplier, time.seconds, DEFAULT_PERIOD, DEFAULT_MODE, DEFAULT_CURRENCY)
  )
);
---

<Layout title="Is It Worth The Time?" description="Calculate how much to spend on time-saving tools based on your salary and the time you'll save.">
  <main class="min-h-screen flex flex-col justify-center">
    <div class="site-section grow-0">
      <header class="text-center mb-12">
        <h1 class="text-4xl lg:text-5xl font-semibold text-slate-800 dark:text-slate-100 mb-1 sm:mb-2" data-i18n="title">
          Is it worth the time?
        </h1>
        <p class="text-lg leading-tight text-slate-600 dark:text-slate-300 mx-auto" id="subtitle">
          How much money you can spend automating a task before you're spending more than you save
        </p>
      </header>

      <div class="table-controls">
        <div class="salary-input-container">
          <label for="salary" class="block text-slate-700 dark:text-slate-300 font-medium mb-1 sm:mb-2" data-i18n="annualSalary">
            Annual Salary
          </label>
          <div class="salary-input-wrapper">
            <span class="salary-prefix" id="currency-symbol">{DEFAULT_CURRENCY}</span>
            <input
              type="text"
              id="salary"
              inputmode="numeric"
              value={DEFAULT_SALARY_STR}
              class="salary-input"
              placeholder={DEFAULT_SALARY_STR}
            />
          </div>
        </div>

        <div class="spend-toggle-container">
          <label class="block text-slate-700 dark:text-slate-300 font-medium mb-1 sm:mb-2" data-i18n="viewAs">View As</label>
          <div class="spend-toggle">
            <button type="button" class="toggle-btn active" data-spend="money" data-i18n="money">Money</button>
            <button type="button" class="toggle-btn" data-spend="time" data-i18n="time">Time</button>
          </div>
        </div>

        <div class="billing-toggle-container">
          <label class="block text-slate-700 dark:text-slate-300 font-medium  mb-1 sm:mb-2" data-i18n="savedPer">Saved Per</label>
          <div class="billing-toggle">
            <button type="button" class="toggle-btn active" data-period="monthly" data-i18n="month">Month</button>
            <button type="button" class="toggle-btn" data-period="annual" data-i18n="year">Year</button>
          </div>
        </div>
      </div>

      <div class="table-container">
        <div class="table-wrapper">
          <table class="time-table">
            <thead>
              <tr>
                <th class="corner-cell">
                  <span class="time-label" data-i18n="timeSaved">Time Saved</span>
                  <span class="freq-label" data-i18n="frequency">Frequency</span>
                </th>
                {frequencies.map((freq, index) => (
                  <th class="freq-header" data-freq-index={index}>{freq.label}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              {timeSavings.map((time, rowIndex) => (
                <tr>
                  <th class="time-header" data-time-index={rowIndex}>{time.label}</th>
                  {frequencies.map((freq, colIndex) => {
                    const cell = preCalculatedData[rowIndex][colIndex];
                    return (
                      <td
                        class={`value-cell ${cell.tier}`}
                        data-freq-multiplier={freq.multiplier}
                        data-time-seconds={time.seconds}
                      >
                        <span class="value" style={`opacity: ${cell.opacity}`}>{cell.text}</span>
                      </td>
                    );
                  })}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <div class="mt-12 text-center text-slate-600 dark:text-slate-400">
        <p class="font-medium mb-2" data-i18n="howToRead">How to read this table</p>
        <p class="text-sm max-w-xl mx-auto mb-2" data-i18n="instructions">
          Each cell is the value of time saved over a month or year based on how often you do the task. For example, a tool saving 1 minute daily is worth up to $17/month on a $100k salary. View As shows monetary value or time saved. Saved Per shows monthly or yearly savings. Based on 2,000 working hours per year (8 hours × 250 days).
        </p>
      </div>

      <footer class="footer mt-12">
        <a href="https://github.com/hoxxep/isitworththetime" target="_blank" rel="noopener noreferrer" class="footer-link">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          <span data-i18n="starOnGithub">Star on GitHub</span>
        </a>
        <a href="https://xkcd.com/1205/" target="_blank" rel="noopener noreferrer" class="footer-link">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
          <span data-i18n="basedOnXkcd">Based on xkcd #1205</span>
        </a>
      </footer>
    </div>
  </main>
</Layout>

<style>
  .table-controls {
    display: flex;
    justify-content: space-evenly;
    align-items: flex-end;
    margin-bottom: 1rem;
    gap: 1rem;
  }

  .salary-input-container {
    flex-shrink: 0;
  }

  .billing-toggle-container,
  .spend-toggle-container {
    flex-shrink: 0;
  }

  .salary-input-wrapper {
    display: flex;
    align-items: center;
    border: 2px solid rgb(var(--accent-border));
    border-radius: 8px;
    background: rgb(var(--bg-surface));
    overflow: hidden;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .salary-input-wrapper:focus-within {
    border-color: rgb(var(--accent-blue));
    box-shadow: 0 0 0 4px rgba(var(--accent-blue), 0.1);
  }

  .salary-input-wrapper input {
    flex: 1;
  }

  .salary-prefix {
    padding-left: 0.75rem;
    font-size: 1rem;
    font-weight: 500;
    color: rgb(var(--accent-grey-light));
    user-select: none;
  }

  .salary-input {
    font-size: 1rem;
    font-weight: 600;
    text-align: left;
    padding: 0.625rem 0.75rem 0.625rem 0.25rem;
    border: none;
    background: transparent;
    color: rgb(var(--accent-grey));
    width: 120px;
    outline: none;
  }

  .billing-toggle,
  .spend-toggle {
    display: flex;
    gap: 0;
  }

  .toggle-btn {
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    border: 2px solid rgb(var(--accent-border));
    background: rgb(var(--bg-surface));
    color: rgb(var(--accent-grey));
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .toggle-btn:first-child {
    border-radius: 8px 0 0 8px;
    border-right: 1px solid rgb(var(--accent-border));
  }

  .toggle-btn:last-child {
    border-radius: 0 8px 8px 0;
    border-left: 1px solid rgb(var(--accent-border));
  }

  .toggle-btn:hover:not(.active) {
    background: rgb(var(--bg-grey));
  }

  .toggle-btn.active {
    background: rgb(var(--bg-blue-light));
    border-color: rgb(var(--accent-blue), 0.2);
    color: rgb(var(--accent-blue));
  }

  .table-container {
    background: rgb(var(--bg-surface));
    border-radius: 16px;
    box-shadow: var(--box-shadow);
    padding: 1rem;
    overflow: hidden;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
  }

  .time-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .time-table th,
  .time-table td {
    padding: 0.875rem 0.75rem;
    text-align: center;
    font-size: 0.875rem;
  }

  .corner-cell {
    position: relative;
    background: linear-gradient(25deg, rgb(var(--bg-grey)) 0%, rgb(var(--bg-blue-light)) 100%);
    min-width: 95px;
    min-height: 40px;
    overflow: hidden;
  }

  .corner-cell .freq-label,
  .corner-cell .time-label {
    position: absolute;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .corner-cell .time-label {
    bottom: 8px;
    left: 8px;
    color: rgb(var(--accent-grey));
  }

  .corner-cell .freq-label {
    top: 8px;
    right: 8px;
    color: rgb(var(--accent-blue));
  }

  .freq-header {
    background: rgb(var(--bg-blue-light));
    color: rgb(var(--accent-blue));
    font-weight: 600;
    white-space: nowrap;
    transition: background-color 0.15s ease, color 0.15s ease;
    min-width: 4rem;
  }

  .freq-header.highlight {
    background: rgb(220, 235, 250);
    //color: white;
  }

  @media (prefers-color-scheme: dark) {
    .freq-header.highlight {
      background: rgb(37, 99, 180);
    }
  }

  .time-header {
    background: rgb(var(--bg-grey));
    color: rgb(var(--accent-grey));
    font-weight: 600;
    text-align: left;
    padding-left: 1rem;
    white-space: nowrap;
    transition: background-color 0.15s ease, color 0.15s ease;
  }

  .time-header.highlight {
    background: rgb(230, 230, 230);
  }

  @media (prefers-color-scheme: dark) {
    .time-header.highlight {
      background: rgb(71, 85, 105);
    }
  }

  .corner-cell, .time-header {
    position: sticky;
    left: 0;
    z-index: 1;
  }

  .value-cell {
    background: rgb(var(--bg-surface));
    transition: background-color 0.15s ease;
  }

  .value-cell:hover {
    background: rgb(var(--bg-blue-light));
  }

  .value-cell .value {
    font-weight: 500;
    color: rgb(var(--accent-grey));
    font-variant-numeric: tabular-nums;
  }

  /* Color coding based on value magnitude */
  .value-cell.tier-1 .value { color: #64748b; }
  .value-cell.tier-2 .value { color: #059669; }
  .value-cell.tier-3 .value { color: #2563eb; }
  .value-cell.tier-4 .value { color: #7c3aed; }
  .value-cell.tier-5 .value { color: #db2777; }

  .value-cell.tier-1 { background: rgba(100, 116, 139, 0.04); }
  .value-cell.tier-2 { background: rgba(5, 150, 105, 0.06); }
  .value-cell.tier-3 { background: rgba(37, 99, 235, 0.06); }
  .value-cell.tier-4 { background: rgba(124, 58, 237, 0.06); }
  .value-cell.tier-5 { background: rgba(219, 39, 119, 0.06); }

  .value-cell.tier-1:hover { background: rgba(100, 116, 139, 0.1); }
  .value-cell.tier-2:hover { background: rgba(5, 150, 105, 0.12); }
  .value-cell.tier-3:hover { background: rgba(37, 99, 235, 0.12); }
  .value-cell.tier-4:hover { background: rgba(124, 58, 237, 0.12); }
  .value-cell.tier-5:hover { background: rgba(219, 39, 119, 0.12); }

  @media (prefers-color-scheme: dark) {
    .value-cell.tier-1 .value { color: #94a3b8; }
    .value-cell.tier-2 .value { color: #34d399; }
    .value-cell.tier-3 .value { color: #60a5fa; }
    .value-cell.tier-4 .value { color: #a78bfa; }
    .value-cell.tier-5 .value { color: #f472b6; }

    .value-cell.tier-1 { background: rgba(148, 163, 184, 0.08); }
    .value-cell.tier-2 { background: rgba(52, 211, 153, 0.1); }
    .value-cell.tier-3 { background: rgba(96, 165, 250, 0.1); }
    .value-cell.tier-4 { background: rgba(167, 139, 250, 0.1); }
    .value-cell.tier-5 { background: rgba(244, 114, 182, 0.1); }

    .value-cell.tier-1:hover { background: rgba(148, 163, 184, 0.15); }
    .value-cell.tier-2:hover { background: rgba(52, 211, 153, 0.18); }
    .value-cell.tier-3:hover { background: rgba(96, 165, 250, 0.18); }
    .value-cell.tier-4:hover { background: rgba(167, 139, 250, 0.18); }
    .value-cell.tier-5:hover { background: rgba(244, 114, 182, 0.18); }
  }

  .footer {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
  }

  .footer-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: rgb(var(--accent-grey));
    text-decoration: none;
    border-radius: 8px;
    border: 1px solid rgb(var(--accent-border));
    background: rgb(var(--bg-surface));
    transition: all 0.15s ease;
  }

  .footer-link:hover {
    border-color: rgb(var(--accent-grey-light));
    background: rgb(var(--bg-grey));
  }

  .footer-icon {
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
  }

  @media (max-width: 640px) {
    .table-controls {
      flex-direction: column;
      align-items: stretch;
      gap: 1rem;
    }

    .salary-input-container,
    .billing-toggle-container,
    .spend-toggle-container {
      text-align: center;
    }

    .salary-input-container .flex {
      justify-content: center;
    }

    .salary-input {
      padding: 0.3rem 0.75rem 0.3rem 0.25rem;
    }

    .toggle-btn {
      padding: 0.3rem 1.25rem;
    }

    .billing-toggle,
    .spend-toggle {
      justify-content: stretch;
    }

    .billing-toggle button,
    .spend-toggle button {
      flex: 1;
    }

    .table-container {
      padding: 0.5rem;
      border-radius: 12px;
    }

    .salary-input {
      font-size: 1rem;
    }

    .corner-cell .time-label {
      bottom: 4px;
      left: 8px;
    }

    .corner-cell .freq-label {
      top: 4px;
      right: 8px;
    }

    .time-table th,
    .time-table td {
      padding: 0.625rem 0.5rem;
      font-size: 0.75rem;
    }

    .footer {
      flex-direction: column;
      gap: 1rem;
    }

    .footer-link {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
  import { getCellDisplay } from '@lib/calculations';

  // ============================================
  // INTERNATIONALIZATION (i18n)
  // ============================================

  interface Translations {
    title: string;
    subtitleMoney: string;
    subtitleTime: string;
    annualSalary: string;
    savedPer: string;
    month: string;
    year: string;
    viewAs: string;
    money: string;
    time: string;
    timeSaved: string;
    frequency: string;
    howToRead: string;
    instructions: string;
    starOnGithub: string;
    basedOnXkcd: string;
    // Frequency labels
    freq50day: string;
    freq5day: string;
    freqDaily: string;
    freqWeekly: string;
    freqMonthly: string;
    freqYearly: string;
    // Time labels
    time1sec: string;
    time5sec: string;
    time30sec: string;
    time1min: string;
    time5min: string;
    time30min: string;
    time1hour: string;
    time4hours: string;
    time1day: string;
  }

  const translations: Record<string, Translations> = {
    en: {
      title: 'Is it worth the time?',
      subtitleMoney: 'How much money you can spend automating a task before you\'re spending more than you save',
      subtitleTime: 'How much time you can spend automating a task before you\'re spending more than you save',
      annualSalary: 'Annual Salary',
      savedPer: 'Saved Per',
      month: 'Month',
      year: 'Year',
      viewAs: 'View As',
      money: 'Money',
      time: 'Time',
      timeSaved: 'Time Saved',
      frequency: 'Frequency',
      howToRead: 'How to read this table',
      instructions: 'Each cell is the value of time saved over a month or year based on how often you do the task. For example, a tool saving 1 minute daily is worth up to $17/month on a $100k salary. View As shows monetary value or time saved. Saved Per shows monthly or yearly savings. Based on 2,000 working hours per year (8 hours × 250 days).',
      starOnGithub: 'Star on GitHub',
      basedOnXkcd: 'Based on xkcd #1205',
      freq50day: '50/day',
      freq5day: '5/day',
      freqDaily: 'Daily',
      freqWeekly: 'Weekly',
      freqMonthly: 'Monthly',
      freqYearly: 'Yearly',
      time1sec: '1 second',
      time5sec: '5 seconds',
      time30sec: '30 seconds',
      time1min: '1 minute',
      time5min: '5 minutes',
      time30min: '30 minutes',
      time1hour: '1 hour',
      time4hours: '4 hours',
      time1day: '1 day',
    },
    es: {
      title: '¿Vale la pena el tiempo?',
      subtitleMoney: 'Cuánto dinero puedes gastar automatizando una tarea antes de gastar más de lo que ahorras',
      subtitleTime: 'Cuánto tiempo puedes dedicar a automatizar una tarea antes de gastar más de lo que ahorras',
      annualSalary: 'Salario Anual',
      savedPer: 'Ahorrado Por',
      month: 'Mes',
      year: 'Año',
      viewAs: 'Ver Como',
      money: 'Dinero',
      time: 'Tiempo',
      timeSaved: 'Tiempo Ahorrado',
      frequency: 'Frecuencia',
      howToRead: 'Cómo leer esta tabla',
      instructions: 'Cada celda es el valor del tiempo ahorrado en un mes o año según la frecuencia con la que realizas la tarea. Por ejemplo, una herramienta que ahorra 1 minuto diario vale hasta $17/mes con un salario de $100k. Ver Como muestra el valor monetario o el tiempo ahorrado. Ahorrado Por muestra los ahorros mensuales o anuales. Basado en 2,000 horas de trabajo por año (8 horas × 250 días).',
      starOnGithub: 'Estrella en GitHub',
      basedOnXkcd: 'Basado en xkcd #1205',
      freq50day: '50/día',
      freq5day: '5/día',
      freqDaily: 'Diario',
      freqWeekly: 'Semanal',
      freqMonthly: 'Mensual',
      freqYearly: 'Anual',
      time1sec: '1 segundo',
      time5sec: '5 segundos',
      time30sec: '30 segundos',
      time1min: '1 minuto',
      time5min: '5 minutos',
      time30min: '30 minutos',
      time1hour: '1 hora',
      time4hours: '4 horas',
      time1day: '1 día',
    },
    fr: {
      title: 'Est-ce que ça vaut le temps?',
      subtitleMoney: 'Combien d\'argent vous pouvez dépenser pour automatiser une tâche avant de dépenser plus que vous n\'économisez',
      subtitleTime: 'Combien de temps vous pouvez consacrer à automatiser une tâche avant de dépenser plus que vous n\'économisez',
      annualSalary: 'Salaire Annuel',
      savedPer: 'Économisé Par',
      month: 'Mois',
      year: 'An',
      viewAs: 'Afficher En',
      money: 'Argent',
      time: 'Temps',
      timeSaved: 'Temps Économisé',
      frequency: 'Fréquence',
      howToRead: 'Comment lire ce tableau',
      instructions: 'Chaque cellule représente la valeur du temps économisé sur un mois ou une année selon la fréquence de la tâche. Par exemple, un outil qui économise 1 minute par jour vaut jusqu\'à 17$/mois avec un salaire de 100k$. Afficher En montre la valeur monétaire ou le temps économisé. Économisé Par montre les économies mensuelles ou annuelles. Basé sur 2 000 heures de travail par an (8 heures × 250 jours).',
      starOnGithub: 'Étoile sur GitHub',
      basedOnXkcd: 'Basé sur xkcd #1205',
      freq50day: '50/jour',
      freq5day: '5/jour',
      freqDaily: 'Quotidien',
      freqWeekly: 'Hebdo',
      freqMonthly: 'Mensuel',
      freqYearly: 'Annuel',
      time1sec: '1 seconde',
      time5sec: '5 secondes',
      time30sec: '30 secondes',
      time1min: '1 minute',
      time5min: '5 minutes',
      time30min: '30 minutes',
      time1hour: '1 heure',
      time4hours: '4 heures',
      time1day: '1 jour',
    },
    de: {
      title: 'Lohnt sich die Zeit?',
      subtitleMoney: 'Wie viel Geld du für die Automatisierung einer Aufgabe ausgeben kannst, bevor du mehr ausgibst als du sparst',
      subtitleTime: 'Wie viel Zeit du für die Automatisierung einer Aufgabe aufwenden kannst, bevor du mehr ausgibst als du sparst',
      annualSalary: 'Jahresgehalt',
      savedPer: 'Gespart Pro',
      month: 'Monat',
      year: 'Jahr',
      viewAs: 'Anzeigen Als',
      money: 'Geld',
      time: 'Zeit',
      timeSaved: 'Gesparte Zeit',
      frequency: 'Häufigkeit',
      howToRead: 'So liest du diese Tabelle',
      instructions: 'Jede Zelle zeigt den Wert der gesparten Zeit über einen Monat oder ein Jahr, je nachdem wie oft du die Aufgabe erledigst. Beispiel: Ein Werkzeug, das täglich 1 Minute spart, ist bei einem Gehalt von 100k$ bis zu 17$/Monat wert. Anzeigen Als zeigt den Geldwert oder die gesparte Zeit. Gespart Pro zeigt monatliche oder jährliche Einsparungen. Basierend auf 2.000 Arbeitsstunden pro Jahr (8 Stunden × 250 Tage).',
      starOnGithub: 'Stern auf GitHub',
      basedOnXkcd: 'Basiert auf xkcd #1205',
      freq50day: '50/Tag',
      freq5day: '5/Tag',
      freqDaily: 'Täglich',
      freqWeekly: 'Wöchentlich',
      freqMonthly: 'Monatlich',
      freqYearly: 'Jährlich',
      time1sec: '1 Sekunde',
      time5sec: '5 Sekunden',
      time30sec: '30 Sekunden',
      time1min: '1 Minute',
      time5min: '5 Minuten',
      time30min: '30 Minuten',
      time1hour: '1 Stunde',
      time4hours: '4 Stunden',
      time1day: '1 Tag',
    },
    pt: {
      title: 'Vale a pena o tempo?',
      subtitleMoney: 'Quanto dinheiro você pode gastar automatizando uma tarefa antes de gastar mais do que economiza',
      subtitleTime: 'Quanto tempo você pode gastar automatizando uma tarefa antes de gastar mais do que economiza',
      annualSalary: 'Salário Anual',
      savedPer: 'Economizado Por',
      month: 'Mês',
      year: 'Ano',
      viewAs: 'Ver Como',
      money: 'Dinheiro',
      time: 'Tempo',
      timeSaved: 'Tempo Economizado',
      frequency: 'Frequência',
      howToRead: 'Como ler esta tabela',
      instructions: 'Cada célula é o valor do tempo economizado em um mês ou ano com base na frequência da tarefa. Por exemplo, uma ferramenta que economiza 1 minuto diário vale até $17/mês com um salário de $100k. Ver Como mostra o valor monetário ou tempo economizado. Economizado Por mostra as economias mensais ou anuais. Baseado em 2.000 horas de trabalho por ano (8 horas × 250 dias).',
      starOnGithub: 'Estrela no GitHub',
      basedOnXkcd: 'Baseado em xkcd #1205',
      freq50day: '50/dia',
      freq5day: '5/dia',
      freqDaily: 'Diário',
      freqWeekly: 'Semanal',
      freqMonthly: 'Mensal',
      freqYearly: 'Anual',
      time1sec: '1 segundo',
      time5sec: '5 segundos',
      time30sec: '30 segundos',
      time1min: '1 minuto',
      time5min: '5 minutos',
      time30min: '30 minutos',
      time1hour: '1 hora',
      time4hours: '4 horas',
      time1day: '1 dia',
    },
    zh: {
      title: '值得花时间吗？',
      subtitleMoney: '在自动化任务上可以花多少钱，才不会花费超过节省的成本',
      subtitleTime: '在自动化任务上可以花多少时间，才不会花费超过节省的成本',
      annualSalary: '年薪',
      savedPer: '节省周期',
      month: '月',
      year: '年',
      viewAs: '显示为',
      money: '金钱',
      time: '时间',
      timeSaved: '节省时间',
      frequency: '频率',
      howToRead: '如何阅读此表',
      instructions: '每个单元格显示根据任务频率在一个月或一年内节省的时间价值。例如，每天节省1分钟的工具，在10万美元年薪下每月价值17美元。显示为显示金钱价值或节省的时间。节省周期显示月度或年度节省。基于每年2,000个工作小时（8小时×250天）。',
      starOnGithub: '在GitHub上加星',
      basedOnXkcd: '基于 xkcd #1205',
      freq50day: '50次/天',
      freq5day: '5次/天',
      freqDaily: '每天',
      freqWeekly: '每周',
      freqMonthly: '每月',
      freqYearly: '每年',
      time1sec: '1秒',
      time5sec: '5秒',
      time30sec: '30秒',
      time1min: '1分钟',
      time5min: '5分钟',
      time30min: '30分钟',
      time1hour: '1小时',
      time4hours: '4小时',
      time1day: '1天',
    },
    ja: {
      title: '時間をかける価値はある？',
      subtitleMoney: 'タスクの自動化に節約以上のコストをかける前に、いくらまでお金を使えるか',
      subtitleTime: 'タスクの自動化に節約以上のコストをかける前に、どれだけ時間を使えるか',
      annualSalary: '年収',
      savedPer: '節約単位',
      month: '月',
      year: '年',
      viewAs: '表示形式',
      money: 'お金',
      time: '時間',
      timeSaved: '節約時間',
      frequency: '頻度',
      howToRead: 'この表の読み方',
      instructions: '各セルは、タスクの頻度に基づいて1ヶ月または1年間で節約される時間の価値を示しています。例えば、毎日1分節約するツールは、年収10万ドルの場合、月額17ドルの価値があります。表示形式は金銭的価値または節約時間を表示します。節約単位は月額または年額の節約を表示します。年間2,000労働時間（8時間×250日）に基づいています。',
      starOnGithub: 'GitHubでスター',
      basedOnXkcd: 'xkcd #1205に基づく',
      freq50day: '50回/日',
      freq5day: '5回/日',
      freqDaily: '毎日',
      freqWeekly: '毎週',
      freqMonthly: '毎月',
      freqYearly: '毎年',
      time1sec: '1秒',
      time5sec: '5秒',
      time30sec: '30秒',
      time1min: '1分',
      time5min: '5分',
      time30min: '30分',
      time1hour: '1時間',
      time4hours: '4時間',
      time1day: '1日',
    },
    it: {
      title: 'Vale la pena il tempo?',
      subtitleMoney: 'Quanto denaro puoi spendere per automatizzare un\'attività prima di spendere più di quanto risparmi',
      subtitleTime: 'Quanto tempo puoi dedicare ad automatizzare un\'attività prima di spendere più di quanto risparmi',
      annualSalary: 'Stipendio Annuale',
      savedPer: 'Risparmiato Per',
      month: 'Mese',
      year: 'Anno',
      viewAs: 'Visualizza Come',
      money: 'Denaro',
      time: 'Tempo',
      timeSaved: 'Tempo Risparmiato',
      frequency: 'Frequenza',
      howToRead: 'Come leggere questa tabella',
      instructions: 'Ogni cella rappresenta il valore del tempo risparmiato in un mese o un anno in base alla frequenza dell\'attività. Ad esempio, uno strumento che risparmia 1 minuto al giorno vale fino a $17/mese con uno stipendio di $100k. Visualizza Come mostra il valore monetario o il tempo risparmiato. Risparmiato Per mostra i risparmi mensili o annuali. Basato su 2.000 ore lavorative all\'anno (8 ore × 250 giorni).',
      starOnGithub: 'Stella su GitHub',
      basedOnXkcd: 'Basato su xkcd #1205',
      freq50day: '50/giorno',
      freq5day: '5/giorno',
      freqDaily: 'Giornaliero',
      freqWeekly: 'Settimanale',
      freqMonthly: 'Mensile',
      freqYearly: 'Annuale',
      time1sec: '1 secondo',
      time5sec: '5 secondi',
      time30sec: '30 secondi',
      time1min: '1 minuto',
      time5min: '5 minuti',
      time30min: '30 minuti',
      time1hour: '1 ora',
      time4hours: '4 ore',
      time1day: '1 giorno',
    },
    nl: {
      title: 'Is het de tijd waard?',
      subtitleMoney: 'Hoeveel geld je kunt uitgeven aan het automatiseren van een taak voordat je meer uitgeeft dan je bespaart',
      subtitleTime: 'Hoeveel tijd je kunt besteden aan het automatiseren van een taak voordat je meer uitgeeft dan je bespaart',
      annualSalary: 'Jaarsalaris',
      savedPer: 'Bespaard Per',
      month: 'Maand',
      year: 'Jaar',
      viewAs: 'Weergeven Als',
      money: 'Geld',
      time: 'Tijd',
      timeSaved: 'Bespaarde Tijd',
      frequency: 'Frequentie',
      howToRead: 'Hoe deze tabel te lezen',
      instructions: 'Elke cel toont de waarde van bespaarde tijd over een maand of jaar op basis van hoe vaak je de taak uitvoert. Bijvoorbeeld, een tool die dagelijks 1 minuut bespaart is tot $17/maand waard bij een salaris van $100k. Weergeven Als toont geldwaarde of bespaarde tijd. Bespaard Per toont maandelijkse of jaarlijkse besparingen. Gebaseerd op 2.000 werkuren per jaar (8 uur × 250 dagen).',
      starOnGithub: 'Ster op GitHub',
      basedOnXkcd: 'Gebaseerd op xkcd #1205',
      freq50day: '50/dag',
      freq5day: '5/dag',
      freqDaily: 'Dagelijks',
      freqWeekly: 'Wekelijks',
      freqMonthly: 'Maandelijks',
      freqYearly: 'Jaarlijks',
      time1sec: '1 seconde',
      time5sec: '5 seconden',
      time30sec: '30 seconden',
      time1min: '1 minuut',
      time5min: '5 minuten',
      time30min: '30 minuten',
      time1hour: '1 uur',
      time4hours: '4 uur',
      time1day: '1 dag',
    },
    ru: {
      title: 'Стоит ли это времени?',
      subtitleMoney: 'Сколько денег можно потратить на автоматизацию задачи, прежде чем затраты превысят экономию',
      subtitleTime: 'Сколько времени можно потратить на автоматизацию задачи, прежде чем затраты превысят экономию',
      annualSalary: 'Годовая зарплата',
      savedPer: 'Сэкономлено за',
      month: 'Месяц',
      year: 'Год',
      viewAs: 'Показать как',
      money: 'Деньги',
      time: 'Время',
      timeSaved: 'Сэкономленное время',
      frequency: 'Частота',
      howToRead: 'Как читать эту таблицу',
      instructions: 'Каждая ячейка показывает ценность сэкономленного времени за месяц или год в зависимости от частоты выполнения задачи. Например, инструмент, экономящий 1 минуту ежедневно, стоит до $17/месяц при зарплате $100k. Показать как отображает денежную ценность или сэкономленное время. Сэкономлено за показывает месячную или годовую экономию. Основано на 2000 рабочих часов в год (8 часов × 250 дней).',
      starOnGithub: 'Звезда на GitHub',
      basedOnXkcd: 'На основе xkcd #1205',
      freq50day: '50/день',
      freq5day: '5/день',
      freqDaily: 'Ежедневно',
      freqWeekly: 'Еженедельно',
      freqMonthly: 'Ежемесячно',
      freqYearly: 'Ежегодно',
      time1sec: '1 секунда',
      time5sec: '5 секунд',
      time30sec: '30 секунд',
      time1min: '1 минута',
      time5min: '5 минут',
      time30min: '30 минут',
      time1hour: '1 час',
      time4hours: '4 часа',
      time1day: '1 день',
    },
  };

  // Detect user locale and get translations
  const userLocale = navigator.language || 'en';
  const lang = userLocale.split('-')[0];
  const t = translations[lang] || translations.en;

  // Currency mapping by region
  function getCurrencyForLocale(locale: string): string {
    const currencyMap: Record<string, string> = {
      // Americas
      'en-US': 'USD', 'en-CA': 'CAD', 'es-MX': 'MXN',
      'es-AR': 'ARS', 'es-CL': 'CLP', 'es-CO': 'COP',
      'pt-BR': 'BRL',
      // Europe
      'en-GB': 'GBP', 'en-IE': 'EUR',
      'de-DE': 'EUR', 'de-AT': 'EUR', 'de-CH': 'CHF',
      'fr-FR': 'EUR', 'fr-BE': 'EUR', 'fr-CH': 'CHF',
      'es-ES': 'EUR', 'pt-PT': 'EUR',
      'it-IT': 'EUR', 'nl-NL': 'EUR', 'nl-BE': 'EUR',
      // Asia
      'ja-JP': 'JPY',
      'zh-CN': 'CNY', 'zh-TW': 'TWD', 'zh-HK': 'HKD',
      // Russia
      'ru-RU': 'RUB',
      // Oceania
      'en-AU': 'AUD', 'en-NZ': 'NZD',
    };

    // Try exact match first
    if (currencyMap[locale]) {
      return currencyMap[locale];
    }

    // Fallback by language code
    const langCode = locale.split('-')[0];
    const langDefaults: Record<string, string> = {
      'en': 'USD',
      'es': 'EUR',
      'fr': 'EUR',
      'de': 'EUR',
      'pt': 'EUR',
      'it': 'EUR',
      'nl': 'EUR',
      'ja': 'JPY',
      'zh': 'CNY',
      'ru': 'RUB',
    };

    return langDefaults[langCode] || 'USD';
  }

  const userCurrency = getCurrencyForLocale(userLocale);

  // Get currency symbol for display in salary input
  function getCurrencySymbol(currency: string): string {
    const symbols: Record<string, string> = {
      'USD': '$', 'CAD': '$', 'MXN': '$',
      'ARS': '$', 'CLP': '$', 'COP': '$',
      'BRL': '$',
      'GBP': '£', 'EUR': '€', 'CHF': 'Fr',
      'JPY': '¥', 'CNY': '¥', 'TWD': '$', 'HKD': '$',
      'RUB': '₽',
      'AUD': '$', 'NZD': '$',
    };
    return symbols[currency] || '$';
  }

  const currencySymbol = getCurrencySymbol(userCurrency);

  // Frequency and time label keys for translation
  const freqKeys = ['freq50day', 'freq5day', 'freqDaily', 'freqWeekly', 'freqMonthly', 'freqYearly'] as const;
  const timeKeys = ['time1sec', 'time5sec', 'time30sec', 'time1min', 'time5min', 'time30min', 'time1hour', 'time4hours', 'time1day'] as const;

  // Update subtitle based on spend mode
  function updateSubtitle(mode: 'money' | 'time') {
    const subtitleEl = document.getElementById('subtitle');
    if (subtitleEl) {
      subtitleEl.textContent = mode === 'money' ? t.subtitleMoney : t.subtitleTime;
    }
  }

  // Apply translations to the page
  function applyTranslations(currentSpendMode: 'money' | 'time') {
    // Update elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n') as keyof Translations;
      if (t[key]) {
        el.textContent = t[key];
      }
    });

    // Update currency symbol
    const currencyEl = document.getElementById('currency-symbol');
    if (currencyEl) {
      currencyEl.textContent = currencySymbol;
    }

    // Update subtitle based on current spend mode
    updateSubtitle(currentSpendMode);

    // Update frequency headers
    document.querySelectorAll<HTMLTableCellElement>('.freq-header').forEach(el => {
      const index = parseInt(el.dataset.freqIndex || '0', 10);
      if (freqKeys[index]) {
        el.textContent = t[freqKeys[index]];
      }
    });

    // Update time row headers
    document.querySelectorAll<HTMLTableCellElement>('.time-header').forEach(el => {
      const index = parseInt(el.dataset.timeIndex || '0', 10);
      if (timeKeys[index]) {
        el.textContent = t[timeKeys[index]];
      }
    });
  }

  const salaryInput = document.getElementById('salary') as HTMLInputElement;
  const valueCells = document.querySelectorAll<HTMLTableCellElement>('.value-cell');
  const periodToggleBtns = document.querySelectorAll<HTMLButtonElement>('.billing-toggle .toggle-btn');
  const spendToggleBtns = document.querySelectorAll<HTMLButtonElement>('.spend-toggle .toggle-btn');

  let billingPeriod: 'annual' | 'monthly' = 'monthly';
  let spendMode: 'money' | 'time' = 'money';

  function parseSalary(value: string): number {
    return parseInt(value.replace(/[^0-9]/g, ''), 10) || 0;
  }

  function formatSalaryInput(value: string): string {
    const num = parseSalary(value);
    if (num === 0) return '';
    return num.toLocaleString('en-US');
  }

  function updateTable() {
    const salary = parseSalary(salaryInput.value);

    valueCells.forEach(cell => {
      const freqMultiplier = parseInt(cell.dataset.freqMultiplier || '0', 10);
      const timeSeconds = parseInt(cell.dataset.timeSeconds || '0', 10);

      const display = getCellDisplay(salary, freqMultiplier, timeSeconds, billingPeriod, spendMode, currencySymbol);

      const valueSpan = cell.querySelector('.value') as HTMLElement;
      if (valueSpan) {
        valueSpan.textContent = display.text;
        valueSpan.style.opacity = String(display.opacity);
      }

      // Update tier class for color coding
      cell.classList.remove('tier-1', 'tier-2', 'tier-3', 'tier-4', 'tier-5');
      if (display.tier) {
        cell.classList.add(display.tier);
      }
    });
  }

  salaryInput.addEventListener('input', (e) => {
    const target = e.target as HTMLInputElement;
    const cursorPos = target.selectionStart || 0;
    const oldLength = target.value.length;

    target.value = formatSalaryInput(target.value);

    // Adjust cursor position after formatting
    const newLength = target.value.length;
    const newCursorPos = Math.max(0, cursorPos + (newLength - oldLength));
    target.setSelectionRange(newCursorPos, newCursorPos);

    updateTable();
  });

  salaryInput.addEventListener('focus', () => {
    salaryInput.select();
  });

  // Period toggle button handlers
  periodToggleBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const period = btn.dataset.period as 'annual' | 'monthly';
      if (period === billingPeriod) return;

      billingPeriod = period;

      // Update active state
      periodToggleBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      updateTable();
    });
  });

  // Spend mode toggle button handlers
  spendToggleBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const mode = btn.dataset.spend as 'money' | 'time';
      if (mode === spendMode) return;

      spendMode = mode;

      // Update active state
      spendToggleBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Update subtitle based on mode
      updateSubtitle(mode);

      updateTable();
    });
  });

  // Header highlight on cell hover
  const freqHeaders = document.querySelectorAll<HTMLTableCellElement>('.freq-header');
  const timeHeaders = document.querySelectorAll<HTMLTableCellElement>('.time-header');

  valueCells.forEach(cell => {
    cell.addEventListener('mouseenter', () => {
      const row = cell.parentElement as HTMLTableRowElement;
      const cellIndex = Array.from(row.cells).indexOf(cell);
      const rowIndex = row.rowIndex - 1; // -1 for thead row

      // Highlight column header (cellIndex includes the row header, so -1)
      if (cellIndex > 0 && freqHeaders[cellIndex - 1]) {
        freqHeaders[cellIndex - 1].classList.add('highlight');
      }

      // Highlight row header
      if (timeHeaders[rowIndex]) {
        timeHeaders[rowIndex].classList.add('highlight');
      }
    });

    cell.addEventListener('mouseleave', () => {
      freqHeaders.forEach(h => h.classList.remove('highlight'));
      timeHeaders.forEach(h => h.classList.remove('highlight'));
    });
  });

  // Apply translations and initial calculation
  applyTranslations(spendMode);
  updateTable();
</script>
