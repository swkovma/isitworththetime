---
import Layout from '@layouts/Layout.astro';

// Columns: frequency (how often you do the task)
// Multipliers based on 250 working days per year (Mon-Fri with 2 weeks holiday)
const frequencies = [
  { label: '50/day', multiplier: 50 * 250 },
  { label: '5/day', multiplier: 5 * 250 },
  { label: 'Daily', multiplier: 250 },
  { label: 'Weekly', multiplier: 50 },
  { label: 'Monthly', multiplier: 12 },
  { label: 'Yearly', multiplier: 1 },
];

// Rows: time saved per occurrence
const timeSavings = [
  { label: '1 second', seconds: 1 },
  { label: '5 seconds', seconds: 5 },
  { label: '30 seconds', seconds: 30 },
  { label: '1 minute', seconds: 60 },
  { label: '5 minutes', seconds: 5 * 60 },
  { label: '30 minutes', seconds: 30 * 60 },
  { label: '1 hour', seconds: 60 * 60 },
  { label: '4 hours', seconds: 4 * 60 * 60 },
  { label: '1 day', seconds: 8 * 60 * 60 },  // assuming 8 working hours in a day
];
---

<Layout title="Is It Worth The Time?" description="Calculate how much to spend on time-saving tools based on your salary and the time you'll save.">
  <main class="min-h-screen">
    <div class="site-section">
      <header class="text-center mb-12">
        <h1 class="text-4xl lg:text-5xl font-semibold text-slate-800 dark:text-slate-100 mb-1 sm:mb-2" data-i18n="title">
          Is it worth the time?
        </h1>
        <p class="text-lg leading-tight text-slate-600 dark:text-slate-300 mx-auto" id="subtitle">
          How much money you can spend automating a task before you're spending more than you save
        </p>
      </header>

      <div class="table-controls">
        <div class="salary-input-container">
          <label for="salary" class="block text-slate-700 dark:text-slate-300 font-medium mb-1 sm:mb-2" data-i18n="annualSalary">
            Annual Salary
          </label>
          <div class="salary-input-wrapper">
            <span class="salary-prefix" id="currency-symbol">$</span>
            <input
              type="text"
              id="salary"
              inputmode="numeric"
              value="100,000"
              class="salary-input"
              placeholder="100,000"
            />
          </div>
        </div>

        <div class="billing-toggle-container">
          <label class="block text-slate-700 dark:text-slate-300 font-medium  mb-1 sm:mb-2" data-i18n="payPer">Pay Per</label>
          <div class="billing-toggle">
            <button type="button" class="toggle-btn active" data-period="monthly" data-i18n="month">Month</button>
            <button type="button" class="toggle-btn" data-period="annual" data-i18n="year">Year</button>
          </div>
        </div>

        <div class="spend-toggle-container">
          <label class="block text-slate-700 dark:text-slate-300 font-medium mb-1 sm:mb-2" data-i18n="spend">Spend</label>
          <div class="spend-toggle">
            <button type="button" class="toggle-btn active" data-spend="money" data-i18n="money">Money</button>
            <button type="button" class="toggle-btn" data-spend="time" data-i18n="time">Time</button>
          </div>
        </div>
      </div>

      <div class="table-container">
        <div class="table-wrapper">
          <table class="time-table">
            <thead>
              <tr>
                <th class="corner-cell">
                  <span class="time-label" data-i18n="timeSaved">Time Saved</span>
                  <span class="freq-label" data-i18n="frequency">Frequency</span>
                </th>
                {frequencies.map((freq, index) => (
                  <th class="freq-header" data-freq-index={index}>{freq.label}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              {timeSavings.map((time, rowIndex) => (
                <tr>
                  <th class="time-header" data-time-index={rowIndex}>{time.label}</th>
                  {frequencies.map((freq) => (
                    <td
                      class="value-cell"
                      data-freq-multiplier={freq.multiplier}
                      data-time-seconds={time.seconds}
                    >
                      <span class="value">—</span>
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <div class="mt-12 text-center text-slate-600 dark:text-slate-400">
        <p class="font-medium mb-2" data-i18n="howToRead">How to read this table</p>
        <p class="text-sm max-w-xl mx-auto mb-2" data-i18n="instructions">
          Each cell is the value of time saved over a month or year based on how often you do the task. For example, a tool saving 1 minute daily is worth up to $17/month on a $100k salary. Pay Per shows monthly or yearly costs. Spend shows monetary value or time saved. Based on 2,000 working hours per year (8 hours × 250 days).
        </p>
      </div>

      <footer class="footer mt-12">
        <a href="https://github.com/hoxxep/isitworththetime" target="_blank" rel="noopener noreferrer" class="footer-link">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          <span data-i18n="starOnGithub">Star on GitHub</span>
        </a>
        <a href="https://xkcd.com/1205/" target="_blank" rel="noopener noreferrer" class="footer-link">
          <svg class="footer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
          <span data-i18n="basedOnXkcd">Based on xkcd #1205</span>
        </a>
      </footer>
    </div>
  </main>
</Layout>

<style>
  .table-controls {
    display: flex;
    justify-content: space-evenly;
    align-items: flex-end;
    margin-bottom: 1rem;
    gap: 1rem;
  }

  .salary-input-container {
    flex-shrink: 0;
  }

  .billing-toggle-container,
  .spend-toggle-container {
    flex-shrink: 0;
  }

  .salary-input-wrapper {
    display: flex;
    align-items: center;
    border: 2px solid rgb(var(--accent-border));
    border-radius: 8px;
    background: rgb(var(--bg-surface));
    overflow: hidden;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .salary-input-wrapper:focus-within {
    border-color: rgb(var(--accent-blue));
    box-shadow: 0 0 0 4px rgba(var(--accent-blue), 0.1);
  }

  .salary-input-wrapper input {
    flex: 1;
  }

  .salary-prefix {
    padding-left: 0.75rem;
    font-size: 1rem;
    font-weight: 500;
    color: rgb(var(--accent-grey-light));
    user-select: none;
  }

  .salary-input {
    font-size: 1rem;
    font-weight: 600;
    text-align: left;
    padding: 0.625rem 0.75rem 0.625rem 0.25rem;
    border: none;
    background: transparent;
    color: rgb(var(--accent-grey));
    width: 120px;
    outline: none;
  }

  .billing-toggle,
  .spend-toggle {
    display: flex;
    gap: 0;
  }

  .toggle-btn {
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    border: 2px solid rgb(var(--accent-border));
    background: rgb(var(--bg-surface));
    color: rgb(var(--accent-grey));
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .toggle-btn:first-child {
    border-radius: 8px 0 0 8px;
    border-right: 1px solid rgb(var(--accent-border));
  }

  .toggle-btn:last-child {
    border-radius: 0 8px 8px 0;
    border-left: 1px solid rgb(var(--accent-border));
  }

  .toggle-btn:hover:not(.active) {
    background: rgb(var(--bg-grey));
  }

  .toggle-btn.active {
    background: rgb(var(--bg-blue-light));
    border-color: rgb(var(--accent-blue), 0.2);
    color: rgb(var(--accent-blue));
  }

  .table-container {
    background: rgb(var(--bg-surface));
    border-radius: 16px;
    box-shadow: var(--box-shadow);
    padding: 1rem;
    overflow: hidden;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
  }

  .time-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .time-table th,
  .time-table td {
    padding: 0.875rem 0.75rem;
    text-align: center;
    font-size: 0.875rem;
  }

  .corner-cell {
    position: relative;
    background: linear-gradient(25deg, rgb(var(--bg-grey)) 0%, rgb(var(--bg-blue-light)) 100%);
    min-width: 95px;
    min-height: 40px;
    overflow: hidden;
  }

  .corner-cell .freq-label,
  .corner-cell .time-label {
    position: absolute;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .corner-cell .time-label {
    bottom: 8px;
    left: 8px;
    color: rgb(var(--accent-grey));
  }

  .corner-cell .freq-label {
    top: 8px;
    right: 8px;
    color: rgb(var(--accent-blue));
  }

  .freq-header {
    background: rgb(var(--bg-blue-light));
    color: rgb(var(--accent-blue));
    font-weight: 600;
    white-space: nowrap;
    transition: background-color 0.15s ease, color 0.15s ease;
    min-width: 4rem;
  }

  .freq-header.highlight {
    background: rgb(220, 235, 250);
    //color: white;
  }

  @media (prefers-color-scheme: dark) {
    .freq-header.highlight {
      background: rgb(37, 99, 180);
    }
  }

  .time-header {
    background: rgb(var(--bg-grey));
    color: rgb(var(--accent-grey));
    font-weight: 600;
    text-align: left;
    padding-left: 1rem;
    white-space: nowrap;
    transition: background-color 0.15s ease, color 0.15s ease;
  }

  .time-header.highlight {
    background: rgb(230, 230, 230);
  }

  @media (prefers-color-scheme: dark) {
    .time-header.highlight {
      background: rgb(71, 85, 105);
    }
  }

  .corner-cell, .time-header {
    position: sticky;
    left: 0;
    z-index: 1;
  }

  .value-cell {
    background: rgb(var(--bg-surface));
    transition: background-color 0.15s ease;
  }

  .value-cell:hover {
    background: rgb(var(--bg-blue-light));
  }

  .value-cell .value {
    font-weight: 500;
    color: rgb(var(--accent-grey));
    font-variant-numeric: tabular-nums;
  }

  /* Color coding based on value magnitude */
  .value-cell.tier-1 .value { color: #64748b; }
  .value-cell.tier-2 .value { color: #059669; }
  .value-cell.tier-3 .value { color: #2563eb; }
  .value-cell.tier-4 .value { color: #7c3aed; }
  .value-cell.tier-5 .value { color: #db2777; }

  .value-cell.tier-1 { background: rgba(100, 116, 139, 0.04); }
  .value-cell.tier-2 { background: rgba(5, 150, 105, 0.06); }
  .value-cell.tier-3 { background: rgba(37, 99, 235, 0.06); }
  .value-cell.tier-4 { background: rgba(124, 58, 237, 0.06); }
  .value-cell.tier-5 { background: rgba(219, 39, 119, 0.06); }

  .value-cell.tier-1:hover { background: rgba(100, 116, 139, 0.1); }
  .value-cell.tier-2:hover { background: rgba(5, 150, 105, 0.12); }
  .value-cell.tier-3:hover { background: rgba(37, 99, 235, 0.12); }
  .value-cell.tier-4:hover { background: rgba(124, 58, 237, 0.12); }
  .value-cell.tier-5:hover { background: rgba(219, 39, 119, 0.12); }

  @media (prefers-color-scheme: dark) {
    .value-cell.tier-1 .value { color: #94a3b8; }
    .value-cell.tier-2 .value { color: #34d399; }
    .value-cell.tier-3 .value { color: #60a5fa; }
    .value-cell.tier-4 .value { color: #a78bfa; }
    .value-cell.tier-5 .value { color: #f472b6; }

    .value-cell.tier-1 { background: rgba(148, 163, 184, 0.08); }
    .value-cell.tier-2 { background: rgba(52, 211, 153, 0.1); }
    .value-cell.tier-3 { background: rgba(96, 165, 250, 0.1); }
    .value-cell.tier-4 { background: rgba(167, 139, 250, 0.1); }
    .value-cell.tier-5 { background: rgba(244, 114, 182, 0.1); }

    .value-cell.tier-1:hover { background: rgba(148, 163, 184, 0.15); }
    .value-cell.tier-2:hover { background: rgba(52, 211, 153, 0.18); }
    .value-cell.tier-3:hover { background: rgba(96, 165, 250, 0.18); }
    .value-cell.tier-4:hover { background: rgba(167, 139, 250, 0.18); }
    .value-cell.tier-5:hover { background: rgba(244, 114, 182, 0.18); }
  }

  .footer {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
  }

  .footer-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: rgb(var(--accent-grey));
    text-decoration: none;
    border-radius: 8px;
    border: 1px solid rgb(var(--accent-border));
    background: rgb(var(--bg-surface));
    transition: all 0.15s ease;
  }

  .footer-link:hover {
    border-color: rgb(var(--accent-grey-light));
    background: rgb(var(--bg-grey));
  }

  .footer-icon {
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
  }

  @media (max-width: 640px) {
    .table-controls {
      flex-direction: column;
      align-items: stretch;
      gap: 1rem;
    }

    .salary-input-container,
    .billing-toggle-container,
    .spend-toggle-container {
      text-align: center;
    }

    .salary-input-container .flex {
      justify-content: center;
    }

    .salary-input {
      padding: 0.3rem 0.75rem 0.3rem 0.25rem;
    }

    .toggle-btn {
      padding: 0.3rem 1.25rem;
    }

    .billing-toggle,
    .spend-toggle {
      justify-content: stretch;
    }

    .billing-toggle button,
    .spend-toggle button {
      flex: 1;
    }

    .table-container {
      padding: 0.5rem;
      border-radius: 12px;
    }

    .salary-input {
      font-size: 1rem;
    }

    .corner-cell .time-label {
      bottom: 4px;
      left: 8px;
    }

    .corner-cell .freq-label {
      top: 4px;
      right: 8px;
    }

    .time-table th,
    .time-table td {
      padding: 0.625rem 0.5rem;
      font-size: 0.75rem;
    }

    .footer {
      flex-direction: column;
      gap: 1rem;
    }

    .footer-link {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
  // 8 hours per day * 250 work days per year
  const WORK_HOURS_PER_YEAR = 8 * 250;

  // ============================================
  // INTERNATIONALIZATION (i18n)
  // ============================================

  interface Translations {
    title: string;
    subtitleMoney: string;
    subtitleTime: string;
    annualSalary: string;
    payPer: string;
    month: string;
    year: string;
    spend: string;
    money: string;
    time: string;
    timeSaved: string;
    frequency: string;
    howToRead: string;
    instructions: string;
    starOnGithub: string;
    basedOnXkcd: string;
    // Frequency labels
    freq50day: string;
    freq5day: string;
    freqDaily: string;
    freqWeekly: string;
    freqMonthly: string;
    freqYearly: string;
    // Time labels
    time1sec: string;
    time5sec: string;
    time30sec: string;
    time1min: string;
    time5min: string;
    time30min: string;
    time1hour: string;
    time4hours: string;
    time1day: string;
  }

  const translations: Record<string, Translations> = {
    en: {
      title: 'Is it worth the time?',
      subtitleMoney: 'How much money you can spend automating a task before you\'re spending more than you save',
      subtitleTime: 'How much time you can spend automating a task before you\'re spending more than you save',
      annualSalary: 'Annual Salary',
      payPer: 'Pay Per',
      month: 'Month',
      year: 'Year',
      spend: 'Spend',
      money: 'Money',
      time: 'Time',
      timeSaved: 'Time Saved',
      frequency: 'Frequency',
      howToRead: 'How to read this table',
      instructions: 'Each cell is the value of time saved over a month or year based on how often you do the task. For example, a tool saving 1 minute daily is worth up to $17/month on a $100k salary. Pay Per shows monthly or yearly costs. Spend shows monetary value or time saved. Based on 2,000 working hours per year (8 hours × 250 days).',
      starOnGithub: 'Star on GitHub',
      basedOnXkcd: 'Based on xkcd #1205',
      freq50day: '50/day',
      freq5day: '5/day',
      freqDaily: 'Daily',
      freqWeekly: 'Weekly',
      freqMonthly: 'Monthly',
      freqYearly: 'Yearly',
      time1sec: '1 second',
      time5sec: '5 seconds',
      time30sec: '30 seconds',
      time1min: '1 minute',
      time5min: '5 minutes',
      time30min: '30 minutes',
      time1hour: '1 hour',
      time4hours: '4 hours',
      time1day: '1 day',
    },
    es: {
      title: '¿Vale la pena el tiempo?',
      subtitleMoney: 'Cuánto dinero puedes gastar automatizando una tarea antes de gastar más de lo que ahorras',
      subtitleTime: 'Cuánto tiempo puedes dedicar a automatizar una tarea antes de gastar más de lo que ahorras',
      annualSalary: 'Salario Anual',
      payPer: 'Pago Por',
      month: 'Mes',
      year: 'Año',
      spend: 'Gastar',
      money: 'Dinero',
      time: 'Tiempo',
      timeSaved: 'Tiempo Ahorrado',
      frequency: 'Frecuencia',
      howToRead: 'Cómo leer esta tabla',
      instructions: 'Cada celda es el valor del tiempo ahorrado en un mes o año según la frecuencia con la que realizas la tarea. Por ejemplo, una herramienta que ahorra 1 minuto diario vale hasta $17/mes con un salario de $100k. Pago Por muestra costos mensuales o anuales. Gastar muestra el valor monetario o el tiempo ahorrado. Basado en 2,000 horas de trabajo por año (8 horas × 250 días).',
      starOnGithub: 'Estrella en GitHub',
      basedOnXkcd: 'Basado en xkcd #1205',
      freq50day: '50/día',
      freq5day: '5/día',
      freqDaily: 'Diario',
      freqWeekly: 'Semanal',
      freqMonthly: 'Mensual',
      freqYearly: 'Anual',
      time1sec: '1 segundo',
      time5sec: '5 segundos',
      time30sec: '30 segundos',
      time1min: '1 minuto',
      time5min: '5 minutos',
      time30min: '30 minutos',
      time1hour: '1 hora',
      time4hours: '4 horas',
      time1day: '1 día',
    },
    fr: {
      title: 'Est-ce que ça vaut le temps?',
      subtitleMoney: 'Combien d\'argent vous pouvez dépenser pour automatiser une tâche avant de dépenser plus que vous n\'économisez',
      subtitleTime: 'Combien de temps vous pouvez consacrer à automatiser une tâche avant de dépenser plus que vous n\'économisez',
      annualSalary: 'Salaire Annuel',
      payPer: 'Payer Par',
      month: 'Mois',
      year: 'An',
      spend: 'Dépenser',
      money: 'Argent',
      time: 'Temps',
      timeSaved: 'Temps Économisé',
      frequency: 'Fréquence',
      howToRead: 'Comment lire ce tableau',
      instructions: 'Chaque cellule représente la valeur du temps économisé sur un mois ou une année selon la fréquence de la tâche. Par exemple, un outil qui économise 1 minute par jour vaut jusqu\'à 17$/mois avec un salaire de 100k$. Payer Par affiche les coûts mensuels ou annuels. Dépenser affiche la valeur monétaire ou le temps économisé. Basé sur 2 000 heures de travail par an (8 heures × 250 jours).',
      starOnGithub: 'Étoile sur GitHub',
      basedOnXkcd: 'Basé sur xkcd #1205',
      freq50day: '50/jour',
      freq5day: '5/jour',
      freqDaily: 'Quotidien',
      freqWeekly: 'Hebdo',
      freqMonthly: 'Mensuel',
      freqYearly: 'Annuel',
      time1sec: '1 seconde',
      time5sec: '5 secondes',
      time30sec: '30 secondes',
      time1min: '1 minute',
      time5min: '5 minutes',
      time30min: '30 minutes',
      time1hour: '1 heure',
      time4hours: '4 heures',
      time1day: '1 jour',
    },
    de: {
      title: 'Lohnt sich die Zeit?',
      subtitleMoney: 'Wie viel Geld du für die Automatisierung einer Aufgabe ausgeben kannst, bevor du mehr ausgibst als du sparst',
      subtitleTime: 'Wie viel Zeit du für die Automatisierung einer Aufgabe aufwenden kannst, bevor du mehr ausgibst als du sparst',
      annualSalary: 'Jahresgehalt',
      payPer: 'Zahlung Pro',
      month: 'Monat',
      year: 'Jahr',
      spend: 'Ausgeben',
      money: 'Geld',
      time: 'Zeit',
      timeSaved: 'Gesparte Zeit',
      frequency: 'Häufigkeit',
      howToRead: 'So liest du diese Tabelle',
      instructions: 'Jede Zelle zeigt den Wert der gesparten Zeit über einen Monat oder ein Jahr, je nachdem wie oft du die Aufgabe erledigst. Beispiel: Ein Werkzeug, das täglich 1 Minute spart, ist bei einem Gehalt von 100k$ bis zu 17$/Monat wert. Zahlung Pro zeigt monatliche oder jährliche Kosten. Ausgeben zeigt den Geldwert oder die gesparte Zeit. Basierend auf 2.000 Arbeitsstunden pro Jahr (8 Stunden × 250 Tage).',
      starOnGithub: 'Stern auf GitHub',
      basedOnXkcd: 'Basiert auf xkcd #1205',
      freq50day: '50/Tag',
      freq5day: '5/Tag',
      freqDaily: 'Täglich',
      freqWeekly: 'Wöchentlich',
      freqMonthly: 'Monatlich',
      freqYearly: 'Jährlich',
      time1sec: '1 Sekunde',
      time5sec: '5 Sekunden',
      time30sec: '30 Sekunden',
      time1min: '1 Minute',
      time5min: '5 Minuten',
      time30min: '30 Minuten',
      time1hour: '1 Stunde',
      time4hours: '4 Stunden',
      time1day: '1 Tag',
    },
    pt: {
      title: 'Vale a pena o tempo?',
      subtitleMoney: 'Quanto dinheiro você pode gastar automatizando uma tarefa antes de gastar mais do que economiza',
      subtitleTime: 'Quanto tempo você pode gastar automatizando uma tarefa antes de gastar mais do que economiza',
      annualSalary: 'Salário Anual',
      payPer: 'Pagar Por',
      month: 'Mês',
      year: 'Ano',
      spend: 'Gastar',
      money: 'Dinheiro',
      time: 'Tempo',
      timeSaved: 'Tempo Economizado',
      frequency: 'Frequência',
      howToRead: 'Como ler esta tabela',
      instructions: 'Cada célula é o valor do tempo economizado em um mês ou ano com base na frequência da tarefa. Por exemplo, uma ferramenta que economiza 1 minuto diário vale até $17/mês com um salário de $100k. Pagar Por mostra custos mensais ou anuais. Gastar mostra o valor monetário ou tempo economizado. Baseado em 2.000 horas de trabalho por ano (8 horas × 250 dias).',
      starOnGithub: 'Estrela no GitHub',
      basedOnXkcd: 'Baseado em xkcd #1205',
      freq50day: '50/dia',
      freq5day: '5/dia',
      freqDaily: 'Diário',
      freqWeekly: 'Semanal',
      freqMonthly: 'Mensal',
      freqYearly: 'Anual',
      time1sec: '1 segundo',
      time5sec: '5 segundos',
      time30sec: '30 segundos',
      time1min: '1 minuto',
      time5min: '5 minutos',
      time30min: '30 minutos',
      time1hour: '1 hora',
      time4hours: '4 horas',
      time1day: '1 dia',
    },
    zh: {
      title: '值得花时间吗？',
      subtitleMoney: '在自动化任务上可以花多少钱，才不会花费超过节省的成本',
      subtitleTime: '在自动化任务上可以花多少时间，才不会花费超过节省的成本',
      annualSalary: '年薪',
      payPer: '支付周期',
      month: '月',
      year: '年',
      spend: '花费',
      money: '金钱',
      time: '时间',
      timeSaved: '节省时间',
      frequency: '频率',
      howToRead: '如何阅读此表',
      instructions: '每个单元格显示根据任务频率在一个月或一年内节省的时间价值。例如，每天节省1分钟的工具，在10万美元年薪下每月价值17美元。支付周期显示月度或年度成本。花费显示金钱价值或节省的时间。基于每年2,000个工作小时（8小时×250天）。',
      starOnGithub: '在GitHub上加星',
      basedOnXkcd: '基于 xkcd #1205',
      freq50day: '50次/天',
      freq5day: '5次/天',
      freqDaily: '每天',
      freqWeekly: '每周',
      freqMonthly: '每月',
      freqYearly: '每年',
      time1sec: '1秒',
      time5sec: '5秒',
      time30sec: '30秒',
      time1min: '1分钟',
      time5min: '5分钟',
      time30min: '30分钟',
      time1hour: '1小时',
      time4hours: '4小时',
      time1day: '1天',
    },
    ja: {
      title: '時間をかける価値はある？',
      subtitleMoney: 'タスクの自動化に節約以上のコストをかける前に、いくらまでお金を使えるか',
      subtitleTime: 'タスクの自動化に節約以上のコストをかける前に、どれだけ時間を使えるか',
      annualSalary: '年収',
      payPer: '支払い単位',
      month: '月',
      year: '年',
      spend: '支出',
      money: 'お金',
      time: '時間',
      timeSaved: '節約時間',
      frequency: '頻度',
      howToRead: 'この表の読み方',
      instructions: '各セルは、タスクの頻度に基づいて1ヶ月または1年間で節約される時間の価値を示しています。例えば、毎日1分節約するツールは、年収10万ドルの場合、月額17ドルの価値があります。支払い単位は月額または年額のコストを表示します。支出は金銭的価値または節約時間を表示します。年間2,000労働時間（8時間×250日）に基づいています。',
      starOnGithub: 'GitHubでスター',
      basedOnXkcd: 'xkcd #1205に基づく',
      freq50day: '50回/日',
      freq5day: '5回/日',
      freqDaily: '毎日',
      freqWeekly: '毎週',
      freqMonthly: '毎月',
      freqYearly: '毎年',
      time1sec: '1秒',
      time5sec: '5秒',
      time30sec: '30秒',
      time1min: '1分',
      time5min: '5分',
      time30min: '30分',
      time1hour: '1時間',
      time4hours: '4時間',
      time1day: '1日',
    },
    it: {
      title: 'Vale la pena il tempo?',
      subtitleMoney: 'Quanto denaro puoi spendere per automatizzare un\'attività prima di spendere più di quanto risparmi',
      subtitleTime: 'Quanto tempo puoi dedicare ad automatizzare un\'attività prima di spendere più di quanto risparmi',
      annualSalary: 'Stipendio Annuale',
      payPer: 'Pagamento Per',
      month: 'Mese',
      year: 'Anno',
      spend: 'Spendere',
      money: 'Denaro',
      time: 'Tempo',
      timeSaved: 'Tempo Risparmiato',
      frequency: 'Frequenza',
      howToRead: 'Come leggere questa tabella',
      instructions: 'Ogni cella rappresenta il valore del tempo risparmiato in un mese o un anno in base alla frequenza dell\'attività. Ad esempio, uno strumento che risparmia 1 minuto al giorno vale fino a $17/mese con uno stipendio di $100k. Pagamento Per mostra i costi mensili o annuali. Spendere mostra il valore monetario o il tempo risparmiato. Basato su 2.000 ore lavorative all\'anno (8 ore × 250 giorni).',
      starOnGithub: 'Stella su GitHub',
      basedOnXkcd: 'Basato su xkcd #1205',
      freq50day: '50/giorno',
      freq5day: '5/giorno',
      freqDaily: 'Giornaliero',
      freqWeekly: 'Settimanale',
      freqMonthly: 'Mensile',
      freqYearly: 'Annuale',
      time1sec: '1 secondo',
      time5sec: '5 secondi',
      time30sec: '30 secondi',
      time1min: '1 minuto',
      time5min: '5 minuti',
      time30min: '30 minuti',
      time1hour: '1 ora',
      time4hours: '4 ore',
      time1day: '1 giorno',
    },
    nl: {
      title: 'Is het de tijd waard?',
      subtitleMoney: 'Hoeveel geld je kunt uitgeven aan het automatiseren van een taak voordat je meer uitgeeft dan je bespaart',
      subtitleTime: 'Hoeveel tijd je kunt besteden aan het automatiseren van een taak voordat je meer uitgeeft dan je bespaart',
      annualSalary: 'Jaarsalaris',
      payPer: 'Betaling Per',
      month: 'Maand',
      year: 'Jaar',
      spend: 'Uitgeven',
      money: 'Geld',
      time: 'Tijd',
      timeSaved: 'Bespaarde Tijd',
      frequency: 'Frequentie',
      howToRead: 'Hoe deze tabel te lezen',
      instructions: 'Elke cel toont de waarde van bespaarde tijd over een maand of jaar op basis van hoe vaak je de taak uitvoert. Bijvoorbeeld, een tool die dagelijks 1 minuut bespaart is tot $17/maand waard bij een salaris van $100k. Betaling Per toont maandelijkse of jaarlijkse kosten. Uitgeven toont geldwaarde of bespaarde tijd. Gebaseerd op 2.000 werkuren per jaar (8 uur × 250 dagen).',
      starOnGithub: 'Ster op GitHub',
      basedOnXkcd: 'Gebaseerd op xkcd #1205',
      freq50day: '50/dag',
      freq5day: '5/dag',
      freqDaily: 'Dagelijks',
      freqWeekly: 'Wekelijks',
      freqMonthly: 'Maandelijks',
      freqYearly: 'Jaarlijks',
      time1sec: '1 seconde',
      time5sec: '5 seconden',
      time30sec: '30 seconden',
      time1min: '1 minuut',
      time5min: '5 minuten',
      time30min: '30 minuten',
      time1hour: '1 uur',
      time4hours: '4 uur',
      time1day: '1 dag',
    },
    ru: {
      title: 'Стоит ли это времени?',
      subtitleMoney: 'Сколько денег можно потратить на автоматизацию задачи, прежде чем затраты превысят экономию',
      subtitleTime: 'Сколько времени можно потратить на автоматизацию задачи, прежде чем затраты превысят экономию',
      annualSalary: 'Годовая зарплата',
      payPer: 'Оплата за',
      month: 'Месяц',
      year: 'Год',
      spend: 'Тратить',
      money: 'Деньги',
      time: 'Время',
      timeSaved: 'Сэкономленное время',
      frequency: 'Частота',
      howToRead: 'Как читать эту таблицу',
      instructions: 'Каждая ячейка показывает ценность сэкономленного времени за месяц или год в зависимости от частоты выполнения задачи. Например, инструмент, экономящий 1 минуту ежедневно, стоит до $17/месяц при зарплате $100k. Оплата за показывает месячные или годовые расходы. Тратить показывает денежную ценность или сэкономленное время. Основано на 2000 рабочих часов в год (8 часов × 250 дней).',
      starOnGithub: 'Звезда на GitHub',
      basedOnXkcd: 'На основе xkcd #1205',
      freq50day: '50/день',
      freq5day: '5/день',
      freqDaily: 'Ежедневно',
      freqWeekly: 'Еженедельно',
      freqMonthly: 'Ежемесячно',
      freqYearly: 'Ежегодно',
      time1sec: '1 секунда',
      time5sec: '5 секунд',
      time30sec: '30 секунд',
      time1min: '1 минута',
      time5min: '5 минут',
      time30min: '30 минут',
      time1hour: '1 час',
      time4hours: '4 часа',
      time1day: '1 день',
    },
  };

  // Detect user locale and get translations
  const userLocale = navigator.language || 'en';
  const lang = userLocale.split('-')[0];
  const t = translations[lang] || translations.en;

  // Currency mapping by region
  function getCurrencyForLocale(locale: string): string {
    const currencyMap: Record<string, string> = {
      // Americas
      'en-US': 'USD', 'en-CA': 'CAD', 'es-MX': 'MXN',
      'es-AR': 'ARS', 'es-CL': 'CLP', 'es-CO': 'COP',
      'pt-BR': 'BRL',
      // Europe
      'en-GB': 'GBP', 'en-IE': 'EUR',
      'de-DE': 'EUR', 'de-AT': 'EUR', 'de-CH': 'CHF',
      'fr-FR': 'EUR', 'fr-BE': 'EUR', 'fr-CH': 'CHF',
      'es-ES': 'EUR', 'pt-PT': 'EUR',
      'it-IT': 'EUR', 'nl-NL': 'EUR', 'nl-BE': 'EUR',
      // Asia
      'ja-JP': 'JPY',
      'zh-CN': 'CNY', 'zh-TW': 'TWD', 'zh-HK': 'HKD',
      // Russia
      'ru-RU': 'RUB',
      // Oceania
      'en-AU': 'AUD', 'en-NZ': 'NZD',
    };

    // Try exact match first
    if (currencyMap[locale]) {
      return currencyMap[locale];
    }

    // Fallback by language code
    const langCode = locale.split('-')[0];
    const langDefaults: Record<string, string> = {
      'en': 'USD',
      'es': 'EUR',
      'fr': 'EUR',
      'de': 'EUR',
      'pt': 'EUR',
      'it': 'EUR',
      'nl': 'EUR',
      'ja': 'JPY',
      'zh': 'CNY',
      'ru': 'RUB',
    };

    return langDefaults[langCode] || 'USD';
  }

  const userCurrency = getCurrencyForLocale(userLocale);

  // Get currency symbol for display in salary input
  function getCurrencySymbol(currency: string): string {
    const symbols: Record<string, string> = {
      'USD': '$', 'CAD': '$', 'MXN': '$',
      'ARS': '$', 'CLP': '$', 'COP': '$',
      'BRL': '$',
      'GBP': '£', 'EUR': '€', 'CHF': 'Fr',
      'JPY': '¥', 'CNY': '¥', 'TWD': '$', 'HKD': '$',
      'RUB': '₽',
      'AUD': '$', 'NZD': '$',
    };
    return symbols[currency] || '$';
  }

  const currencySymbol = getCurrencySymbol(userCurrency);

  // Frequency and time label keys for translation
  const freqKeys = ['freq50day', 'freq5day', 'freqDaily', 'freqWeekly', 'freqMonthly', 'freqYearly'] as const;
  const timeKeys = ['time1sec', 'time5sec', 'time30sec', 'time1min', 'time5min', 'time30min', 'time1hour', 'time4hours', 'time1day'] as const;

  // Update subtitle based on spend mode
  function updateSubtitle(mode: 'money' | 'time') {
    const subtitleEl = document.getElementById('subtitle');
    if (subtitleEl) {
      subtitleEl.textContent = mode === 'money' ? t.subtitleMoney : t.subtitleTime;
    }
  }

  // Apply translations to the page
  function applyTranslations(currentSpendMode: 'money' | 'time') {
    // Update elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n') as keyof Translations;
      if (t[key]) {
        el.textContent = t[key];
      }
    });

    // Update currency symbol
    const currencyEl = document.getElementById('currency-symbol');
    if (currencyEl) {
      currencyEl.textContent = currencySymbol;
    }

    // Update subtitle based on current spend mode
    updateSubtitle(currentSpendMode);

    // Update frequency headers
    document.querySelectorAll<HTMLTableCellElement>('.freq-header').forEach(el => {
      const index = parseInt(el.dataset.freqIndex || '0', 10);
      if (freqKeys[index]) {
        el.textContent = t[freqKeys[index]];
      }
    });

    // Update time row headers
    document.querySelectorAll<HTMLTableCellElement>('.time-header').forEach(el => {
      const index = parseInt(el.dataset.timeIndex || '0', 10);
      if (timeKeys[index]) {
        el.textContent = t[timeKeys[index]];
      }
    });
  }

  const salaryInput = document.getElementById('salary') as HTMLInputElement;
  const valueCells = document.querySelectorAll<HTMLTableCellElement>('.value-cell');
  const periodToggleBtns = document.querySelectorAll<HTMLButtonElement>('.billing-toggle .toggle-btn');
  const spendToggleBtns = document.querySelectorAll<HTMLButtonElement>('.spend-toggle .toggle-btn');

  let billingPeriod: 'annual' | 'monthly' = 'monthly';
  let spendMode: 'money' | 'time' = 'money';

  function parseSalary(value: string): number {
    return parseInt(value.replace(/[^0-9]/g, ''), 10) || 0;
  }

  function formatCurrency(value: number): string {
    if (value >= 1_000_000_000) {
      return currencySymbol + Math.round(value / 1_000_000_000) + 'B';
    }
    if (value >= 10_000_000) {
      return currencySymbol + Math.round(value / 1_000_000) + 'M';
    }
    if (value >= 1_000_000) {
      return currencySymbol + (value / 1_000_000).toFixed(0).replace(/\.0$/, '') + 'M';
    }
    if (value >= 10_000) {
      return currencySymbol + Math.round(value / 1000) + 'k';
    }
    if (value >= 1_000) {
      return currencySymbol + (value / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
    }
    if (value >= 1) {
      return currencySymbol + Math.round(value);
    }
    if (value >= 0.1) {
      return currencySymbol + value.toFixed(2);
    }
    return currencySymbol + '0';
  }

  /**
   * Format seconds as human-readable time duration with aggressive rounding.
   * This is a simple flat calculation - future versions may incorporate
   * productivity multipliers, future discounting, or flow-change probabilities.
   *
   * We assume an 8-hour workday and 250 workdays per year, so saving 21 hours over the course of
   * a year would round to "3d" (3 days).
   */
  function formatTime(totalSeconds: number): string {
    if (totalSeconds < 1) {
      return '<1s';
    }

    // Careful to use 250 work days, 8 hours per day
    const SECONDS_PER_MINUTE = 60;
    const SECONDS_PER_HOUR = 60 * SECONDS_PER_MINUTE;
    const SECONDS_PER_DAY = 8 * SECONDS_PER_HOUR;  // 8 hours per day
    const SECONDS_PER_WEEK = 5 * SECONDS_PER_DAY;  // 5 working days per week
    const SECONDS_PER_YEAR = 250 * SECONDS_PER_DAY;  // 250 working days per year

    // Years (250 work days)
    if (totalSeconds >= SECONDS_PER_YEAR * 0.75) {
      const years = Math.round(totalSeconds / SECONDS_PER_YEAR);
      return `${years}y`;
    }

    // Weeks (round to nearest week when >= 4 days)
    if (totalSeconds >= SECONDS_PER_DAY * 4) {
      const weeks = Math.round(totalSeconds / SECONDS_PER_WEEK);
      return `${weeks}w`;
    }

    // Days (round to nearest day when >= 1.5 days)
    if (totalSeconds >= SECONDS_PER_DAY * 1.5) {
      const days = Math.round(totalSeconds / SECONDS_PER_DAY);
      return `${days}d`;
    }

    // 1 day threshold
    if (totalSeconds >= SECONDS_PER_DAY * 0.75) {
      return '1d';
    }

    // Hours (round to nearest hour when >= 2 hours)
    if (totalSeconds >= SECONDS_PER_HOUR * 2) {
      const hours = Math.round(totalSeconds / SECONDS_PER_HOUR);
      return `${hours}h`;
    }

    // 1 hour threshold
    if (totalSeconds >= SECONDS_PER_HOUR * 0.75) {
      return '1h';
    }

    // Minutes (round to nearest minute when >= 2 minutes)
    if (totalSeconds >= SECONDS_PER_MINUTE * 2) {
      const minutes = Math.round(totalSeconds / SECONDS_PER_MINUTE);
      return `${minutes}m`;
    }

    // 1 minute threshold
    if (totalSeconds >= SECONDS_PER_MINUTE * 0.75) {
      return '1m';
    }

    // Seconds
    return `${Math.round(totalSeconds)}s`;
  }

  /**
   * Calculate the effective time saved based on raw time savings.
   *
   * This currently returns a flat time saved, but is designed to be replaced with a more
   * sophisticated calculation, such as:
   * - Future discounting (probability that workflow changes)
   * - Productivity gain multipliers (compounding benefits)
   * - Context-switching cost savings
   *
   * Flat-rate break even over 1 year might be the best fits-all-use-cases model, so we're
   * happy with this for now.
   */
  function calculateEffectiveTimeSaved(rawSecondsPerYear: number): number {
    return rawSecondsPerYear;
  }

  function formatSalaryInput(value: string): string {
    const num = parseSalary(value);
    if (num === 0) return '';
    return num.toLocaleString('en-US');
  }

  function getOpacity(value: number, salary: number): number {
    // Fade high values
    const HIGH_FADE_START = salary * 0.05;
    const HIGH_FADE_END = salary * 2.00;
    const highRaw = 1 - (Math.log(value) - Math.log(HIGH_FADE_START)) / (Math.log(HIGH_FADE_END) - Math.log(HIGH_FADE_START));
    const highOpacity = Math.min(1, Math.max(0.2, highRaw));

    // Fade low values (below $1, fading to min at $0.01)
    const LOW_FADE_START = 5;
    const LOW_FADE_END = 1;
    let lowOpacity = 1;
    if (value < LOW_FADE_START) {
      const lowRaw = (value - LOW_FADE_END) / (LOW_FADE_START - LOW_FADE_END);
      lowOpacity = Math.min(1, Math.max(0.2, lowRaw));
    }

    return Math.min(highOpacity, lowOpacity);
  }

  function getTimeOpacity(seconds: number): number {
    const SECONDS_PER_DAY = 28800;
    const SECONDS_PER_WEEK = SECONDS_PER_DAY * 5;
    const SECONDS_PER_YEAR = SECONDS_PER_DAY * 250;

    // Fade low values (under 1 minute)
    const LOW_FADE_START = 60; // 1 minute
    const LOW_FADE_END = 1;    // 1 second
    let lowOpacity = 1;
    if (seconds < LOW_FADE_START) {
      const lowRaw = (seconds - LOW_FADE_END) / (LOW_FADE_START - LOW_FADE_END);
      lowOpacity = Math.min(1, Math.max(0.2, lowRaw));
    }

    // Fade high values (unrealistic time savings)
    // Start fading at 1 month (4 weeks), fully faded at 1 year
    const HIGH_FADE_START = SECONDS_PER_WEEK * 4;  // ~1 month
    const HIGH_FADE_END = SECONDS_PER_YEAR;        // 1 year
    let highOpacity = 1;
    if (seconds > HIGH_FADE_START) {
      const highRaw = 1 - (Math.log(seconds) - Math.log(HIGH_FADE_START)) /
                          (Math.log(HIGH_FADE_END) - Math.log(HIGH_FADE_START));
      highOpacity = Math.min(1, Math.max(0.2, highRaw));
    }

    return Math.min(lowOpacity, highOpacity);
  }

  function getTier(value: number, salary: number): string {
    // normalise the tier levels to 100k
    const ratio = 100000 * (value / salary);
    if (ratio < 10) return 'tier-1';
    if (ratio < 100) return 'tier-2';
    if (ratio < 1000) return 'tier-3';
    if (ratio < 10000) return 'tier-4';
    return 'tier-5';
  }

  function updateTable() {
    const salary = parseSalary(salaryInput.value);
    const hourlyRate = salary / WORK_HOURS_PER_YEAR;
    const periodDivisor = billingPeriod === 'monthly' ? 12 : 1;

    valueCells.forEach(cell => {
      const freqMultiplier = parseInt(cell.dataset.freqMultiplier || '0', 10);
      const timeSeconds = parseInt(cell.dataset.timeSeconds || '0', 10);

      // Total time saved per year (in seconds)
      const rawSecondsPerYear = freqMultiplier * timeSeconds;
      const effectiveSecondsPerYear = calculateEffectiveTimeSaved(rawSecondsPerYear);

      // Total time saved in hours per year (for money calculation)
      const totalHoursPerYear = effectiveSecondsPerYear / 3600;

      // Value of time saved (annual)
      const annualValue = hourlyRate * totalHoursPerYear;

      // Display time saved (divided for monthly if applicable)
      const displaySeconds = effectiveSecondsPerYear / periodDivisor;

      // Display money value (divided for monthly)
      const displayMoney = annualValue / periodDivisor;

      const valueSpan = cell.querySelector('.value') as HTMLElement;
      if (valueSpan) {
        if (spendMode === 'money') {
          valueSpan.textContent = salary > 0 ? formatCurrency(displayMoney) : '—';
          // Use annual value for opacity/tier to keep consistent visual hierarchy
          valueSpan.style.opacity = salary > 0 ? String(getOpacity(annualValue, salary)) : '1';
        } else {
          // Time mode - show time saved
          valueSpan.textContent = formatTime(displaySeconds);
          // For time mode, fade both very small and ludicrously large values
          valueSpan.style.opacity = String(getTimeOpacity(displaySeconds));
        }
      }

      // Update tier class for color coding
      cell.classList.remove('tier-1', 'tier-2', 'tier-3', 'tier-4', 'tier-5');
      if (spendMode === 'money' && salary > 0 && annualValue > 0) {
        cell.classList.add(getTier(annualValue, salary));
      } else if (spendMode === 'time') {
        // Time-based tiers by displayed unit (matching formatTime thresholds)
        // s=grey, m=green, h=blue, d=purple, w/y=red
        const SECONDS_PER_MINUTE = 60;
        const SECONDS_PER_HOUR = 3600;
        const SECONDS_PER_DAY = 28800;

        if (displaySeconds < SECONDS_PER_MINUTE * 0.75) {
          cell.classList.add('tier-1'); // seconds - grey
        } else if (displaySeconds < SECONDS_PER_HOUR * 0.75) {
          cell.classList.add('tier-2'); // minutes - green
        } else if (displaySeconds < SECONDS_PER_DAY * 0.75) {
          cell.classList.add('tier-3'); // hours - blue
        } else if (displaySeconds < SECONDS_PER_DAY * 4) {
          cell.classList.add('tier-4'); // days - purple
        } else {
          cell.classList.add('tier-5'); // weeks/years - red
        }
      }
    });
  }

  salaryInput.addEventListener('input', (e) => {
    const target = e.target as HTMLInputElement;
    const cursorPos = target.selectionStart || 0;
    const oldLength = target.value.length;

    target.value = formatSalaryInput(target.value);

    // Adjust cursor position after formatting
    const newLength = target.value.length;
    const newCursorPos = Math.max(0, cursorPos + (newLength - oldLength));
    target.setSelectionRange(newCursorPos, newCursorPos);

    updateTable();
  });

  salaryInput.addEventListener('focus', () => {
    salaryInput.select();
  });

  // Period toggle button handlers
  periodToggleBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const period = btn.dataset.period as 'annual' | 'monthly';
      if (period === billingPeriod) return;

      billingPeriod = period;

      // Update active state
      periodToggleBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      updateTable();
    });
  });

  // Spend mode toggle button handlers
  spendToggleBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const mode = btn.dataset.spend as 'money' | 'time';
      if (mode === spendMode) return;

      spendMode = mode;

      // Update active state
      spendToggleBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Update subtitle based on mode
      updateSubtitle(mode);

      updateTable();
    });
  });

  // Header highlight on cell hover
  const freqHeaders = document.querySelectorAll<HTMLTableCellElement>('.freq-header');
  const timeHeaders = document.querySelectorAll<HTMLTableCellElement>('.time-header');

  valueCells.forEach(cell => {
    cell.addEventListener('mouseenter', () => {
      const row = cell.parentElement as HTMLTableRowElement;
      const cellIndex = Array.from(row.cells).indexOf(cell);
      const rowIndex = row.rowIndex - 1; // -1 for thead row

      // Highlight column header (cellIndex includes the row header, so -1)
      if (cellIndex > 0 && freqHeaders[cellIndex - 1]) {
        freqHeaders[cellIndex - 1].classList.add('highlight');
      }

      // Highlight row header
      if (timeHeaders[rowIndex]) {
        timeHeaders[rowIndex].classList.add('highlight');
      }
    });

    cell.addEventListener('mouseleave', () => {
      freqHeaders.forEach(h => h.classList.remove('highlight'));
      timeHeaders.forEach(h => h.classList.remove('highlight'));
    });
  });

  // Apply translations and initial calculation
  applyTranslations(spendMode);
  updateTable();
</script>
